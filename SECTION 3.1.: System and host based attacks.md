# SYSTEM AND HOST BASED ATTACKS

Attacks that are targeted towards a specific system or host running a specific operating system.

Comes in play after gaining access to a target network.

Focused on misconfigurations and inherent vulnerabilities on the target OS.

## WINDOWS


- C programming language

**Severe vulnerabilitites** over the last 15 years:
- Conflicker MS08-67
- EternalBlue MS17-010
    - Windows versions: windows Vista, 7, 8.1, 10, Server 2008, 2012, 2016
    - Tools: AutoBlue, metasploit
- BlueKeep
    - Windows versions: Vista, 2008 & R2, XP, 7
    - Tools: metasploit


Types of **Windows vulnerabilities**:
- Information disclosure
- Buffer overflow
- Remote code execution
- Privilege escalation
- Denial of service

Windows has native services and protocols that an attacker can utilize as an access vector to gain access to a target host. Most frequently exploited services are:

- Microsoft IIS
- WebDAV
- SMB
- RDP
- WinRM

MICROSOFT IIS
=============
Extensible software used to host websites and web apps.

**Port**: 80/443

Supports .asp, .aspx, .config, .php

WEBDAV
======

Extension of http protocol that allows users to edit and manage files on remote web servers.

Runs on top of Microsoft IIS.

Requires username and password authentication.

**Steps for exploitation**:
1. Identifying Microsoft IIS Server
2. Brute force authentication attacks:
    - `davtest`
3. Upload files
    - `cadaver`

**Ports**: 80/443

SMB
===

File sharing protocol to share files and peripherrals in a local network.

**Port**: 139 or 445 on top of NetBIOS

**SAMBA**: allows windows to access linux shares and devices

- **User authentication**: username and password
- **Share authentication**: password

**PsExec**: network protocol that allows remote access of a computer with a command line interface. Authentication is made via SMB.

**Steps for exploitation**:

1. Brute force with username and password/password hashes
    - `enum4linux`
    - `hydra`
    - `smbmap`
    - `metasploit`
2. Execution of arbitrary commands

RDP
===

GUI remote access oriticik to connect and interact with Windows system.

**Port**: 3389 or any TCP port

Authentication is made with username and password.

WINRM
=====

Remote management protocol to facilitate remote access to windows systems over HTTP(S)

**Ports**: 5985/5986 and 443

**Steps for exploitation**:
- Tools: `crackmapexec`, `evil-winrm`

PRIVILEGE ESCALATION
====================

Major determinant in pentest.

## Windows kernel

Core program that has complete control of resources and hardware. Translation layes between hardware and software.

- User mode: limited access to system resources and functionality
- Kernel mode: unrestricted access

**Tools**: `Windows-Exploit-Suggester` and `Windows-Kernel-Exploits`

## UAC

User account crontrol used to ensure that changes in the operating system require approval from the administrator or user from administrator local group. A non privilege user will be prompt with a program that asks for admin credentials.

**Steps for exploiting**:
1. Access with a user account of local administrator group
2. **Tool**: `UACMe`

## Tokens

Created and managed by LSASS. Provides to users with access to a system resource without having to provide credential each time a process is started. Generated by winlogon.exe with a indetity and privileges and then attach to child process with userinit.exe.

- **Impersonate tokens**: can be used to impersonate a token on the local system
- **Delegate tokens**: can be used to impersonate a token on any system

Privileges needed to impersonation attacks:
- SeAssignPrimaryToken
- SeCreateToken
- SeImpersonatePrivilege


**Tool**: `metasploit with - Incognito`

## ADS

Alternate Data Streams designed to provide compatibility with MacOS HFS. Contains Data Stream and Resource stream metadata. Can be used to hide malicious code.

## HASHES

Process of converting a piece of data into another values. Hashes are stored in lsass.exe process.

- LM: in windows prior to NT 4.0, breaks password in two, convert them to uppercase and then hash it with DES algoritm
- NTLM: protocols to facilitate authentication with username and passwords. Uses MD4 hash algorithm.

**Tools**: `mimikatz`, `metasploit` (Kiwi)

**Pass-The-Hash attacks**: `metasploit`, `crackmapexec`

## SAM

Database file managing user accounts and passwords. All passwords are hashed in SAM databases. It cannot be copied when system is running. It is needed in memory techniques to dump SAM hashes.

## Configurations files

Unattendeed windows setupt utility automate mass installation and deployments of windws. It also automate repetitive tasks. Utilizes configuration files that contains user accounts credentials.

- C:\System\Panther\Unattend.xml
- C:\System\Panther\Autounattend.xml


## LINUX